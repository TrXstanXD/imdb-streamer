<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Details</title>
  <link rel="icon" href="favicon.png" type="image/png">
  <style>
    body {
      background-color: #111;
      color: #eee;
      font-family: Arial, sans-serif;
      padding: 40px;
      text-align: center;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: #222;
      padding: 20px;
      border-radius: 10px;
    }
    img {
      width: 200px;
      border-radius: 10px;
    }
    h1 {
      font-size: 24px;
    }
    p {
      color: #ccc;
    }
    select, .watch-btn {
      margin-top: 15px;
      padding: 8px;
      font-size: 14px;
      border-radius: 6px;
      border: none;
    }
    .watch-btn {
      background-color: #28a745;
      color: white;
      text-decoration: none;
      display: inline-block;
      cursor: pointer;
    }
    .watch-btn:hover {
      background-color: #218838;
    }
    iframe {
      margin-top: 20px;
      width: 100%;
      height: 350px;
      border: none;
      border-radius: 10px;
      display: none;
    }
  </style>
</head>
<body>

<a href="index.html" style="position: absolute; top: 20px; left: 20px; background-color: #333; color: #fff; padding: 8px 12px; border-radius: 6px; text-decoration: none; font-size: 14px;">
  ⬅️ Home
</a>

<div class="container" id="container"></div>
<iframe id="videoFrame"></iframe>

<script>
  const apiKey = "656d0795";
  const urlParams = new URLSearchParams(window.location.search);
  const imdbID = urlParams.get("id");
  const container = document.getElementById("container");
  const iframe = document.getElementById("videoFrame");

  async function loadDetails() {
    const res = await fetch(`https://www.omdbapi.com/?apikey=${apiKey}&i=${imdbID}&plot=full`);
    const data = await res.json();

    const isSeries = data.Type === "series";

    let html = `
      <img src="${data.Poster !== "N/A" ? data.Poster : "https://via.placeholder.com/100x150?text=No+Image"}" alt="Poster">
      <h1>${data.Title} (${data.Year})</h1>
      <p>${data.Plot}</p>
    `;

    if (isSeries) {
      html += `
        <select id="seasonSelect"></select>
        <select id="episodeSelect"></select>
        <br>
        <button class="watch-btn" id="watchBtn">▶️ Watch</button>
      `;
    } else {
      html += `<button class="watch-btn" id="watchBtn">▶️ Watch</button>`;
    }

    container.innerHTML = html;

    const watchBtn = document.getElementById("watchBtn");

    if (isSeries) {
      const seasonSelect = document.getElementById("seasonSelect");
      const episodeSelect = document.getElementById("episodeSelect");

      for (let i = 1; i <= parseInt(data.totalSeasons); i++) {
        const option = document.createElement("option");
        option.value = i;
        option.textContent = `Season ${i}`;
        seasonSelect.appendChild(option);
      }

      seasonSelect.addEventListener("change", () => loadEpisodes(seasonSelect.value));
      episodeSelect.addEventListener("change", () => {
        const url = `https://multiembed.mov/directstream.php?video_id=${imdbID}&s=${seasonSelect.value}&e=${episodeSelect.value}`;
        iframe.src = url;
        iframe.style.display = "block";
      });

      watchBtn.addEventListener("click", () => {
        const url = `https://multiembed.mov/directstream.php?video_id=${imdbID}&s=${seasonSelect.value}&e=${episodeSelect.value}`;
        iframe.src = url;
        iframe.style.display = "block";
      });

      await loadEpisodes(1);
    } else {
      const url = `https://multiembed.mov/directstream.php?video_id=${imdbID}`;
      watchBtn.addEventListener("click", () => {
        iframe.src = url;
        iframe.style.display = "block";
      });
    }
  }

  async function loadEpisodes(season) {
    const res = await fetch(`https://www.omdbapi.com/?apikey=${apiKey}&i=${imdbID}&season=${season}`);
    const data = await res.json();
    const episodeSelect = document.getElementById("episodeSelect");

    episodeSelect.innerHTML = "";
    for (const ep of data.Episodes) {
      const opt = document.createElement("option");
      opt.value = ep.Episode;
      opt.textContent = `Ep ${ep.Episode}: ${ep.Title}`;
      episodeSelect.appendChild(opt);
    }
  }

  loadDetails();
</script>

</body>
</html>
